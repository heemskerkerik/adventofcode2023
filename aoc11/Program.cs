using MoreLinq;

// const string input = "...#......\n.......#..\n#.........\n..........\n......#...\n.#........\n.........#\n..........\n.......#..\n#...#.....";
const string input = "......#.....#.........................#...........#..........#.....#.......#..............#.................................................\n.....................#....................................................................................#........#........#.......#.......\n.........................................................#............................#..................................................#..\n.........................#.......#..............................#............................#.................#............................\n..................#...................................................................................#.....................................\n...........................................#....................................#.................................................#.........\n...........................................................#..........#..........................#..........................................\n............#...............#..............................................................#................................................\n...#.................#.............................................................................................#........................\n........#..........................#.................#....................#.................................................................\n.................#............................#..................................#..................#...........................#...........\n........................................#.................#............................#...................#...............................#\n...............................#..................#..................................................................................#......\n..............#.........#...................................................................................................................\n......................................................#....................................#.....#....................#.....................\n#..................#........#.............#......................#.................#.....................#.....................#............\n............................................................................................................................................\n........#....................................................................................................#......................#.....#.\n................................#............#...............#...........#............#.....................................................\n.................................................................................................................#..........................\n................#..........................................................................#................................................\n.....................#.................#..........#............................#.............................................#..............\n......#................................................#....................................................................................\n...................................#................................#..................#............#.........#........................#....\n..........................................#.................................................................................................\n............................................................................................#.........................#.....................\n.............................#..............................................................................................................\n#...............#......#.................................#..........................#.............................#.........................\n.................................#.......................................................................#...................#..............\n....#.....................................................................#....................#..........................................#.\n............................................#.........#..........................#...............................................#..........\n............................................................................................................................................\n.........................#....................................#........................................#................#...................\n.......#...........................#..................................................#.....#...............................................\n.................................................................................................................#...................#......\n.............#...............................................................#..................#...........................#...............\n..................#.........................................................................................................................\n.........#............................#........#.........#.........#................................................#...................#...\n............................................................................................................................................\n......................#..................................................................................#.......................#..........\n...........................................................................#........#............#..........................................\n............#..............#.........................................#......................................................................\n.....#............#.................................#......................................#...............................#...............#\n............................................................................................................................................\n#.........................................#.................................................................................................\n........................#..........#...........#..............#...................................#.........................................\n........................................................#..........................#.......................#....................#...........\n...........................................................................#................................................................\n..#....................................#...........................#...................#....................................................\n.......#............................................#................................................................#......................\n..............#............#...............................................................#..................#.............................\n......................................................................#.........#....................................................#......\n............................................................................................................................................\n..........#..........#.........................#............#...........................#........#..........................................\n...........................................................................#............................#....................#...........#..\n.............................#..................................................................................#...........................\n..........................................#.................................................................................................\n.....#..........#................#..................................................#......#.............................#......#...........\n............................................................................................................................................\n.#.........#..............#..................#........#..........#.....................................#....................................\n........................................#.....................................................#..........................................#..\n..............................#...........................................#................................#.........#......................\n............................................................................................................................................\n............................................................................................................................................\n......#...........................#.................#...........................#.......................#................#.............#....\n..........................#.............................................#...................................................................\n................................................................#...........................................................................\n........................................#...............#.............................#.....#......................................#........\n......................#...........................................................................#..............#..........................\n..................................................#.........#......#...........................................................#........#...\n..#..............#..........................#................................#.....#........................................................\n............................................................................................................................................\n....................................#.................................#........................#.......#......#..........#..................\n.......#...............................................................................#...................................................#\n...............#.......................................#........................................................................#...........\n...........................................#................................................................................................\n.......................#..............#............................................#................................................#.......\n............................................................................................................................................\n.#..........................#............................#..................................#..........#......#.............................\n............................................................................................................................................\n............................................................................................................................................\n............#......#.....#.......................#...............................................#..........................................\n..........................................................................................#..............#..................................\n.....................................................................#............................................#.........................\n................................................................................#.........................................#.................\n....#..........#..................................................................................................................#.....#...\n........................................................#...................................#......#........................................\n........#...........#......#......................#.....................#............#......................................................\n...................................#..............................#...........................................................#.............\n.................................................................................................................#..........................\n.........................................#............#....................#..................#......................................#......\n........................#.....................#...........................................................................................#.\n...................................................................................................#.....#..................................\n............................................................................................................................................\n.....................................#...................#...............................................................#.....#............\n.....................#........................................#.......................#.....................................................\n.............#............#.....#...........................................#......................................................#.......#\n.......#...................................................................................#..............#.................................\n#.......................................#.............................#.............................................#.......................\n...................................#............................#..............................#......................................#.....\n..............................................................................................................#.............#...............\n........................................................................................#..........#........................................\n...............#..........................#..............#..........#.......................................................................\n......#..................................................................#.......................................#.................#........\n................................................#...........................................................#.................#.............\n#...................#........#...................................................................#..........................................\n............................................#...................................#...........#.......................#.......................\n........#...................................................................................................................................\n.....................................#............#.........#......#................................................................#.......\n.................#....................................................................#..............#......................................\n................................................................................................#.........................#.................\n...........................#..............#.................................................................................................\n..........#.................................................................................................................................\n................................................#.......#...........................#........#....................#................#........\n.......................................#.........................#..................................#......#................................\n..................................#.................#....................................#.................................#...............#\n...........................................#................................................................................................\n......#.....................................................................................................................................\n......................#.......#......................................#......#...............................................................\n................................................#......#...............................................................#................#...\n..............#................................................................................#.............................#..............\n..........................................#.............................#........................................#..........................\n.........................#...........................................................................#..............................#.......\n....................................#.......................................................................................................\n....#...............#..............................................#....................#...........................#.......................\n..........................................................#.................................................................................\n..........................................................................#.......................#.........................................\n..............#.............................................................................................#...................#.........#.\n.......................#.....................#.......................#............................................#.........................\n...............................#...................................................#........................................................\n.................#......................................................................#............................................#......\n.......#...................................................#................#........................#..................#...................\n.#...........#..............#...............................................................................................................\n.....................#............................#.................#............#..............#...........................................\n...........................................#...........#.................#.................................#................................\n...............................#......................................................#....................................................#\n.............................................................................#..............................................................\n.................................................................................................................................#..........\n.......................#...........#..........#............#.....#........................#.............................................#...\n.#..........#...............#......................................................#......................#......#..........................";

bool[][] grid = input.Split('\n')
                     .Select(l => l.Select(c => c == '#').ToArray())
                     .ToArray();

// DumpGrid();

var horizontalExpansions = new List<int>();
var verticalExpansions = new List<int>();

for (int row = 0; row < grid.Length; row += 1)
{
    if (grid[row].Any(cell => cell))
        continue;

    verticalExpansions.Add(row);
}

for (int col = 0; col < grid[0].Length; col += 1)
{
    if (grid.Any(row => row[col]))
        continue;
    
    horizontalExpansions.Add(col);
}

// DumpGrid();

long part1 = FindGalaxies()
            .Subsets(2)
            .Select(pair => (a: pair[0], b: pair[1], dist: GetDistance(pair, expansionSize: 1)))
            .Sum(p => p.dist);
Console.WriteLine(part1);

long part2 = FindGalaxies()
           .Subsets(2)
           .Select(pair => (a: pair[0], b: pair[1], dist: GetDistance(pair, expansionSize: 999_999)))
           .Sum(p => p.dist);
Console.WriteLine(part2);


void DumpGrid()
{
    for (int row = 0; row < grid.Length; row += 1)
    {
        for (int col = 0; col < grid[0].Length; col += 1)
            Console.Write(grid[row][col] ? '#' : '.');
    
        Console.WriteLine();
    }
}

IEnumerable<(int row, int col)> FindGalaxies()
{
    var result = new List<(int row, int col)>();
    
    for (int row = 0; row < grid.Length; row += 1)
    for (int col = 0; col < grid[0].Length; col += 1)
        if (grid[row][col])
            result.Add((row, col));

    return result;
}

long GetDistance(IList<(int row, int col)> pair, int expansionSize)
{
    int[] cols = [pair[0].col, pair[1].col];
    int[] rows = [pair[0].row, pair[1].row];
    
    Array.Sort(cols);
    Array.Sort(rows);

    int horizontalDistance = cols[1] - cols[0];
    int verticalDistance = rows[1] - rows[0];

    checked
    {
        horizontalDistance += horizontalExpansions.Where(e => e >= cols[0] && e <= cols[1])
                                                  .Sum(_ => expansionSize);
        verticalDistance += verticalExpansions.Where(e => e >= rows[0] && e <= rows[1])
                                              .Sum(_ => expansionSize);
    }

    return horizontalDistance + verticalDistance;
}
